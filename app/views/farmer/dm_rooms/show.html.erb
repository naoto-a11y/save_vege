
<div class="container my-5">
  <h2 class="mb-4 text-center">DMルーム</h2>

  <div class="shadow p-4">
    <div class="overflow-auto" style="max-height: 400px;">
      <% @dm_messages.each do |message| %>
        <div class="mb-3">
        <% if message.sender == current_customer || message.sender == current_farmer %>
        <div class="text-left">
          <div class="d-flex align-items-center mb-1">
            <%= image_tag message.sender.get_profile_image, class: "rounded-circle", size: "40x40" %>
            <span class="badge badge-secondary ml-2"><%= message.sender.last_name %></span>
          </div>
          <div class="d-inline-block bg-success text-white rounded-pill px-3 py-2 mt-1">
            <%= message.message %>
          </div>
          <small class="text-muted d-block mt-1"><%= message.created_at.strftime('%Y/%m/%d %H:%M') %></small>
        </div>
      <% else %>
        <div class="text-right">
          <div class="d-flex justify-content-end align-items-center mb-1">
            <span class="badge badge-success mr-2"><%= message.sender.last_name %></span>
            <%= image_tag message.sender.get_profile_image, class: "rounded-circle", size: "40x40" %>
          </div>
          <div class="d-inline-block bg-white rounded-pill px-3 py-2 mt-1">
            <%= message.message %>
          </div>
          <small class="text-muted d-block mt-1"><%= message.created_at.strftime('%Y/%m/%d %H:%M') %></small>
        </div>
      <% end %>
        </div>
      <% end %>
    </div>

    <hr>

    <%= form_with model: [@dm_room, DmMessage.new], url: dm_room_dm_messages_path(@dm_room), local: true do |f| %>
      <div class="form-group">
        <%= f.text_area :message, class: "form-control", placeholder: "メッセージを入力", rows: 3 %>
      </div>
      <div class="text-right">
        <%= f.submit "送信", class: "btn btn-outline-success" %>
      </div>
    <% end %>
  </div>
</div>
