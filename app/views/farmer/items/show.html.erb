<div class="container-fluid px-5 mx-5 my-4">
  <div class="row">
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šå·¦ -->
    <div class="col-3">
      <%= render 'share/info', farmer: @farmer %>
      <%= link_to farmer_reservations_path, class: "btn btn-outline-dark w-100 my-2" do %>
        äºˆç´„ä¸€è¦§ï¼ˆ<%= @reservation_count %>ï¼‰
      <% end %>
    </div>


      <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼šå³ -->
    <div class="col-8 px-5 mx-3">
      <div class="card shadow-sm p-4 mb-4 w-100">
        <div class="d-flex justify-content-between">
          <!-- å·¦ç«¯ã«ç”»åƒ -->
          <div class="mx-5 px-5">
            <%= image_tag @item.get_image, class: "img-fluid rounded mb-3", style: "width: 450px; height: 350px; object-fit: cover;" %>
            <h5 class="mt-4">è²©å£²å…ˆ</h5>
            <!-- åœ°å›³è¡¨ç¤º -->
            <% if @item.farmer.latitude && @item.farmer.longitude %>
              <div id="map" style="width: 400px; height: 400px;" class="mt-3"></div>
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  const lat = <%= @item.farmer.latitude %>;
                  const lng = <%= @item.farmer.longitude %>;

                  const map = L.map('map').setView([lat, lng], 15);
                  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                  }).addTo(map);

                  L.marker([lat, lng]).addTo(map)
                    .bindPopup("<%= j @item.farmer.address %>")  // â†ä½æ‰€ã‚‚farmerã®ã‚‚ã®ã‚’è¡¨ç¤º
                    .openPopup();
                });
              </script>
            <% else %>
              <p class="text-muted">â€»åœ°å›³æƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
              <p>è²©å£²å…ˆä½æ‰€ï¼š<%= @item.farmer.seller_address %></p>
            <% end %>
          </div>
      
          <!-- å³ç«¯ã«å•†å“æƒ…å ± -->
          <div class="ml-5 mr-5 pr-5">
            <h1 class="mb-3 fw-bold"><%= @item.name %></h1>
            <p class="text-muted fs-5 mb-2">ç”Ÿç”£è€…ï¼š<strong><%= @item.farmer.last_name %>ã•ã‚“</strong></p>
            <p class="fs-5 mb-3"><%= @item.introduction %></p>
            <p class="h4 text-success mb-3">ï¿¥<%= number_with_delimiter(@item.price) %>ï¼ˆç¨è¾¼ï¼‰</p>
            <p class="fs-5 text-danger mb-3">â¤ï¸ <%= @item.favorites.count %> ã„ã„ã­</p>
            <p>
              <% @item.tags.each do |tag| %>
                ğŸ”–<%= tag.tag_name %>
              <% end %>
            </p><br>
            <%= link_to "å•†å“æƒ…å ±ã‚’ç·¨é›†", edit_farmer_item_path(@item), class: "btn btn-outline-primary mt-2" %>
            <%= link_to "å•†å“ã‚’å‰Šé™¤", farmer_item_path(@item), method: :delete, data: { confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" }, class: "btn btn-outline-danger mt-2" %>
            <% if @item.is_active == true %>
              <%= link_to "å•†å“æƒ…å ±ã‚’éå…¬é–‹ã«ã™ã‚‹", farmer_deactivate_farmer_item_path(@item),
              method: :patch, data: { confirm: "æœ¬å½“ã«ã“ã®å•†å“ã‚’éå…¬é–‹ã«ã—ã¾ã™ã‹ï¼Ÿ" }, class: "btn btn-outline-dark mt-2" %>
            <% else %>
              <%= link_to "å•†å“æƒ…å ±ã‚’å…¬é–‹ã™ã‚‹", farmer_activate_farmer_item_path(@item),
              method: :patch, data: { confirm: "æœ¬å½“ã«ã“ã®å•†å“ã‚’å…¬é–‹ã—ã¾ã™ã‹ï¼Ÿ" }, class: "btn btn-outline-success mt-2" %>
            <% end %>
          </div>
        </div>
      </div>
      <!-- ã‚³ãƒ¡ãƒ³ãƒˆ -->
      <%= render 'public/comments/index', comments: @comments, item: @item, comment: @comment %>
    </div>
  </div>
</div>

