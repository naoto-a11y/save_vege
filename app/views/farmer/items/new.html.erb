<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">

      <h3 class="text-center mb-3">å•†å“ã‚’è¿½åŠ </h3>

      <%= form_with model: @item, url: farmer_items_path, local: true, html: { multipart: true } do |f| %>
     
        <div class="form-group row mb-2">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :name, "å•†å“å" %></label>
          <div class="col-sm-9"><%= f.text_field :name, class: "form-control form-control-sm" %></div>
        </div>

     
        <div class="form-group row mb-2">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :image, "ç”»åƒ" %></label>
          <div class="col-sm-9"><%= f.file_field :image, class: "form-control form-control-sm" %></div>
        </div>

       
        <div class="form-group row mb-2">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :price, "å€¤æ®µï¼ˆå††ï¼‰" %></label>
          <div class="col-sm-9"><%= f.number_field :price, class: "form-control form-control-sm", min: 0 %></div>
        </div>

    
        <div class="form-group row mb-2">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :introduction, "ç´¹ä»‹æ–‡" %></label>
          <div class="col-sm-9"><%= f.text_area :introduction, class: "form-control form-control-sm", rows: 3 %></div>
        </div>

        <div class="form-group row mb-2">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :harvest_date, "åç©«æ—¥" %></label>
          <div class="col-sm-9"><%= f.date_field :harvest_date, class: "form-control form-control-sm" %></div>
        </div>

     
        <div class="form-group row mb-2">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :category_id, "ã‚«ãƒ†ã‚´ãƒª" %></label>
          <div class="col-sm-9">
            <%= f.collection_select :category_id, Category.all, :id, :name, prompt: "ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ", class: "form-control form-control-sm" %>
          </div>
        </div>

      
        <div class="form-group row mb-3">
          <label class="col-sm-3 col-form-label text-sm-right"><%= f.label :tag_names, "ã‚¿ã‚°" %></label>
          <div class="col-sm-9">
            <%= f.text_field :tag_names, class: "form-control form-control-sm", placeholder: "ä¾‹ï¼‰ã«ã‚“ã˜ã‚“,ç”˜ã„,æ—¬" %>
          </div>
        </div>

        <div class="available-slot mb-3">
          <div class="form-group row mb-3">
            <label class="col-sm-3 col-form-label text-sm-right">
              <%= f.label :available_date, "å—å–å¯èƒ½æ—¥" %>
            </label>
            <div class="col-sm-9">
              <%= f.date_field :available_date, class: "form-control form-control-sm" %>
            </div>
          </div>

          <button type="button" class="btn btn-danger btn-sm remove-slot " >ğŸ—‘</button>
        </div>

        <button type="button" class="btn btn-outline-success mb-3" id="add-slot">ï¼‹ æ™‚é–“å¸¯ã‚’è¿½åŠ </button>   
           

        <div class="text-center">
          <%= f.submit "æŠ•ç¨¿ã™ã‚‹", class: "btn btn-success btn-sm px-4" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const addBtn = document.getElementById("add-slot");
  const container = document.getElementById("available-slots");
  const template = document.getElementById("slot-template").innerHTML;

  // ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ 
  addBtn.addEventListener("click", () => {
    const currentCount = container.querySelectorAll(".available-slot").length;
    if (currentCount >= 10) {
      alert("ã“ã‚Œä»¥ä¸Šã¯è¿½åŠ ã§ãã¾ã›ã‚“");
      return;
    }

    const newIndex = Date.now();
    const newField = template.replace(/\[available_slots_attributes\]\[\d*\]/g, `[available_slots_attributes][${newIndex}]`)
                             .replace(/_available_slots_attributes_\d*_/g, `_available_slots_attributes_${newIndex}_`);

    container.insertAdjacentHTML("beforeend", newField);
  });

  // ãƒ•ã‚©ãƒ¼ãƒ å‰Šé™¤ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆå§”ä»»ï¼‰
  container.addEventListener("click", function (e) {
    if (e.target.classList.contains("remove-slot")) {
      e.target.closest(".available-slot").remove();
    }
  });
});
</script>